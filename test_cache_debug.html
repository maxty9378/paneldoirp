<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ –∫—ç—à–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—Ö–æ–¥–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>–û—Ç–ª–∞–¥–∫–∞ –∫—ç—à–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—Ö–æ–¥–∞</h1>
    
    <div class="section">
        <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∫—ç—à–∞</h3>
        <button onclick="checkCache()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à</button>
        <div id="cacheResult" class="log"></div>
    </div>

    <div class="section">
        <h3>2. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <button onclick="addTestUser()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <div id="addResult" class="log"></div>
    </div>

    <div class="section">
        <h3>3. –°–∏–º—É–ª—è—Ü–∏—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã</h3>
        <button onclick="simulateLogout()">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤—ã—Ö–æ–¥</button>
        <div id="logoutResult" class="log"></div>
    </div>

    <div class="section">
        <h3>4. –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞</h3>
        <button onclick="clearCache()">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</button>
        <div id="clearResult" class="log"></div>
    </div>

    <script>
        function log(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = isError ? 'error' : 'success';
            element.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            element.scrollTop = element.scrollHeight;
        }

        function checkCache() {
            const resultDiv = document.getElementById('cacheResult');
            resultDiv.innerHTML = '';
            
            try {
                const cached = localStorage.getItem('cached_users');
                if (cached) {
                    const users = JSON.parse(cached);
                    log('cacheResult', `‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫—ç—à–µ: ${users.length}`);
                    users.forEach((user, i) => {
                        log('cacheResult', `${i + 1}. ${user.full_name} (${user.email}) - ${user.role}`);
                    });
                } else {
                    log('cacheResult', '‚ùå –ö—ç—à –ø—É—Å—Ç', true);
                }
            } catch (error) {
                log('cacheResult', `‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∫—ç—à–∞: ${error.message}`, true);
            }
        }

        function addTestUser() {
            const resultDiv = document.getElementById('addResult');
            resultDiv.innerHTML = '';
            
            try {
                const testUser = {
                    id: 'test-user-' + Date.now(),
                    email: 'test@example.com',
                    full_name: '–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    role: 'employee',
                    last_sign_in_at: new Date().toISOString(),
                    avatar_url: null
                };
                
                const cached = localStorage.getItem('cached_users');
                let users = cached ? JSON.parse(cached) : [];
                
                // –£–¥–∞–ª—è–µ–º –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å
                users = users.filter(u => u.id !== testUser.id);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
                users.unshift(testUser);
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                if (users.length > 10) {
                    users = users.slice(0, 10);
                }
                
                localStorage.setItem('cached_users', JSON.stringify(users));
                log('addResult', `‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω: ${testUser.full_name}`);
                log('addResult', `üìä –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫—ç—à–µ: ${users.length}`);
                
            } catch (error) {
                log('addResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        function simulateLogout() {
            const resultDiv = document.getElementById('logoutResult');
            resultDiv.innerHTML = '';
            
            try {
                log('logoutResult', 'üîÑ –°–∏–º—É–ª–∏—Ä—É–µ–º –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã...');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫—ç—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π
                const cachedUsers = localStorage.getItem('cached_users');
                log('logoutResult', `üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π: ${cachedUsers ? JSON.parse(cachedUsers).length : 0}`);
                
                // –û—á–∏—â–∞–µ–º sessionStorage
                sessionStorage.clear();
                log('logoutResult', 'üßπ sessionStorage –æ—á–∏—â–µ–Ω');
                
                // –û—á–∏—â–∞–µ–º localStorage
                localStorage.clear();
                log('logoutResult', 'üßπ localStorage –æ—á–∏—â–µ–Ω');
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—ç—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                if (cachedUsers) {
                    localStorage.setItem('cached_users', cachedUsers);
                    const restoredUsers = JSON.parse(cachedUsers);
                    log('logoutResult', `‚úÖ –ö—ç—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${restoredUsers.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
                    restoredUsers.forEach((user, i) => {
                        log('logoutResult', `${i + 1}. ${user.full_name} (${user.email})`);
                    });
                } else {
                    log('logoutResult', '‚ùå –ù–µ—á–µ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å - –∫—ç—à –±—ã–ª –ø—É—Å—Ç', true);
                }
                
            } catch (error) {
                log('logoutResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        function clearCache() {
            const resultDiv = document.getElementById('clearResult');
            resultDiv.innerHTML = '';
            
            try {
                localStorage.removeItem('cached_users');
                log('clearResult', '‚úÖ –ö—ç—à –æ—á–∏—â–µ–Ω');
            } catch (error) {
                log('clearResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            checkCache();
        };
    </script>
</body>
</html>
